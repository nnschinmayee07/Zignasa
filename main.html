<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DeXpress â€” Interactive Deployment UI</title>
  <meta name="color-scheme" content="light dark">
  <style>
    :root{
      --bg:#f6f8fb; --card:#fff; --muted:#6b7280; --text:#0f1724;
      --accent: linear-gradient(90deg,#0066ff,#ff0033); --accent-solid:#0066ff;
      --radius:12px; --shadow: 0 10px 30px rgba(16,24,40,0.06);
      --nav-h:70px; --access-h:58px;
      --success:#0f7a48; --danger:#c22a2a;
    }
    .theme-red{ --accent: linear-gradient(90deg,#ff6b6b,#ff8a8a); --accent-solid:#ff6b6b; }
    .dark{ --bg:#0b1220; --card:#071021; --muted:#9aa4b2; --text:#e6eef8; }

    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;}
    body{background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased;scroll-behavior:smooth}
    .app{min-height:100vh;display:flex;flex-direction:column}

    /* Header */
    header.toolbar{
      height:var(--nav-h); display:flex;align-items:center;justify-content:space-between;padding:0 20px;
      position:fixed;left:0;right:0;top:0;background:rgba(255,255,255,0.86);backdrop-filter: blur(6px);
      box-shadow:0 4px 16px rgba(16,24,40,0.06);z-index:1000;
    }
    .brand{display:flex;gap:12px;align-items:center}
    .logo img{width:44px;height:44px;border-radius:12px;object-fit:cover;display:block}
    .brand span{font-weight:700;color:var(--accent-solid);font-size:18px}

    nav.topnav{display:flex;gap:12px;align-items:center}
    nav.topnav a{color:var(--muted);text-decoration:none;padding:8px 12px;border-radius:10px;font-weight:600}
    nav.topnav a.active{background:linear-gradient(90deg,rgba(0,102,255,0.08),rgba(255,0,51,0.06));color:var(--accent-solid)}

    .user{display:flex;gap:10px;align-items:center}
    .avatar{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;color:#fff;background:linear-gradient(180deg,#0066ff,#ff0033)}

    /* Access nav */
    .access-nav{position:fixed;top:calc(var(--nav-h) + 8px);left:50%;transform:translateX(-50%);z-index:950;
      background:rgba(255,255,255,0.88);padding:6px;border-radius:999px;display:flex;gap:8px;align-items:center;box-shadow:0 6px 20px rgba(16,24,40,0.06);height:var(--access-h)}
    .access-btn{border:0;background:transparent;padding:10px 16px;border-radius:999px;font-weight:700;color:var(--muted);cursor:pointer}
    .access-btn.active{background:var(--accent);color:#fff;box-shadow:0 8px 24px rgba(0,102,255,0.12)}

    /* Main */
    main{padding-top:calc(var(--nav-h) + var(--access-h) + 36px);flex:1}
    .container{max-width:1100px;margin:0 auto;padding:24px}

    /* Hero & cards */
    .hero{padding:36px;border-radius:16px;background:linear-gradient(180deg,rgba(255,255,255,0.6),rgba(255,255,255,0.45));box-shadow:var(--shadow);text-align:center}
    .hero h1{font-size:32px;margin:6px 0}
    .hero p{color:var(--muted);margin:0 0 14px}

    .grid{display:grid;gap:18px}
    .grid-3{grid-template-columns:repeat(3,1fr)}
    .grid-2{grid-template-columns:repeat(2,1fr)}
    .card{background:var(--card);padding:18px;border-radius:12px;box-shadow:var(--shadow);border:1px solid rgba(15,23,36,0.04)}
    .muted{color:var(--muted);font-size:14px}

    /* results table */
    .results-table{width:100%;border-collapse:collapse;margin-top:12px}
    .results-table th,.results-table td{padding:12px;border-bottom:1px solid rgba(15,23,36,0.04);text-align:left}
    .status{padding:6px 10px;border-radius:999px;font-weight:700}
    .status.success{background:#eafaf0;color:var(--success)}
    .status.failed{background:#fdecea;color:var(--danger)}

    /* forms / modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(2,6,23,0.45);display:flex;align-items:center;justify-content:center;z-index:2000}
    .modal{width:100%;max-width:760px;background:var(--card);border-radius:12px;padding:18px;box-shadow:0 30px 60px rgba(2,6,23,0.35)}
    .form-row{display:flex;gap:12px}
    .form-row .col{flex:1}
    .field{display:flex;flex-direction:column;gap:6px;margin-bottom:10px}
    input[type="text"], input[type="url"], select, textarea, input[type="number"]{
      padding:10px;border-radius:8px;border:1px solid rgba(15,23,36,0.06);font-size:14px;background:transparent;color:var(--text)
    }
    textarea{min-height:110px;resize:vertical}

    .btn{display:inline-flex;align-items:center;gap:10px;padding:10px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:700}
    .btn.primary{background:var(--accent);color:#fff}
    .btn.ghost{background:transparent;border:1px solid rgba(15,23,36,0.06)}
    .btn.warn{background:#fef3c7;color:#92400e}

    /* progress/logs */
    .progress{height:12px;border-radius:999px;background:linear-gradient(90deg, rgba(0,0,0,0.06), rgba(0,0,0,0.02));overflow:hidden}
    .progress > i{display:block;height:100%;width:0%;background:linear-gradient(90deg,#0066ff,#ff0033);transition:width .3s ease}

    .logs{background:#0b1220;color:#dbeafe;padding:12px;border-radius:8px;font-family:monospace;height:160px;overflow:auto}

    /* small helpers */
    .flex{display:flex;gap:12px;align-items:center}
    .right{margin-left:auto}
    .kbd{background:#111827;color:#fff;padding:4px 8px;border-radius:6px;font-size:12px}

    /* responsive */
    @media (max-width:900px){
      .grid-3{grid-template-columns:1fr}
      .form-row{flex-direction:column}
      nav.topnav{display:none}
      .access-nav{left:14px;transform:none;width:calc(100% - 28px)}
    }
  </style>
</head>
<body>

<div class="app">

  <!-- header -->
  <header class="toolbar" role="banner">
    <div class="brand">
      <div class="logo">
        <!-- Google Drive thumbnail link (works in many cases); replace if you have a direct image URL -->
        <img id="brandLogo" src="https://drive.google.com/thumbnail?id=1OFonl14VlrMn_Y4Ql2T0Dc-aJFS-kXUj" alt="DeXpress logo">
      </div>
      <span id="brandName">DeXpress</span>
    </div>

    <nav class="topnav" role="navigation" aria-label="main nav">
      <a href="#home" data-target="home" class="navlink active">Home</a>
      <a href="#dashboard" data-target="dashboard" class="navlink">Dashboard</a>
      <a href="#deploy" data-target="deploy" class="navlink">Deploy</a>
      <a href="#results" data-target="results" class="navlink">Results</a>
      <a href="#feedback" data-target="feedback" class="navlink">Feedback</a>
    </nav>

    <div class="user">
      <button id="openDeploy" class="btn primary" title="New deployment">New Deployment</button>
      <button id="toggleTheme" class="btn ghost" title="Toggle theme">THEME</button>
      <div class="avatar" title="User">DX</div>
    </div>
  </header>

  <!-- access nav -->
  <div class="access-nav" role="tablist" aria-label="sections">
    <button class="access-btn active" data-target="home">Home</button>
    <button class="access-btn" data-target="deploy">Deploy</button>
    <button class="access-btn" data-target="dashboard">Dashboard</button>
    <button class="access-btn" data-target="results">Results</button>
    <button class="access-btn" data-target="feedback">Feedback</button>
  </div>

  <!-- main -->
  <main>
    <div class="container">

      <!-- HERO -->
      <section id="home" class="page">
        <div class="hero">
          <div style="display:flex;gap:12px;justify-content:center;align-items:center">
            <span class="kbd">âš¡ DeXpress</span>
          </div>
          <h1>Deploy code to production â€” in one click</h1>
          <p class="muted">Create deployments, watch logs live, and manage projects. Try the interactive demo below.</p>
          <div style="display:flex;gap:12px;justify-content:center;margin-top:12px;flex-wrap:wrap">
            <button id="heroDeploy" class="btn primary">Start Deploying</button>
            <button id="openReactDemo" class="btn ghost">Open React Demo</button>
            <button id="exportJson" class="btn ghost">Export Projects (JSON)</button>
            <input id="importFile" type="file" accept="application/json" style="display:none" />
            <button id="importBtn" class="btn ghost">Import Projects</button>
          </div>
        </div>
      </section>

      <!-- DEPLOY + FORM -->
      <section id="deploy" class="page">
        <div class="grid grid-2">
          <div class="card">
            <div style="display:flex;align-items:center;gap:12px">
              <div style="font-weight:800;font-size:18px">Deploy New Project</div>
              <div class="muted" style="margin-left:auto">Interactive form & simulated deploy</div>
            </div>
            <p class="muted" style="margin-top:8px">Fill details and deploy. You can choose to send payload to a real API endpoint or run a simulation locally.</p>

            <div style="margin-top:10px">
              <label class="muted">Project Name</label>
              <input id="inlineProjectName" type="text" placeholder="my-awesome-app" value="my-awesome-app"/>

              <label class="muted" style="margin-top:8px">Repository URL</label>
              <input id="inlineRepo" type="url" placeholder="https://github.com/your/repo" />

              <div class="form-row" style="margin-top:8px">
                <div class="col">
                  <label class="muted">Framework</label>
                  <select id="inlineFramework">
                    <option>Auto-detect</option>
                    <option>React</option>
                    <option>Next.js</option>
                    <option>Vue</option>
                    <option>Node</option>
                  </select>
                </div>
                <div class="col">
                  <label class="muted">Region</label>
                  <select id="inlineRegion">
                    <option>us-east-1</option>
                    <option>eu-west-1</option>
                    <option>ap-south-1</option>
                  </select>
                </div>
              </div>

              <div style="display:flex;gap:8px;margin-top:12px;align-items:center">
                <input id="inlineSendApi" type="checkbox"/>
                <label class="muted">Send payload to API endpoint</label>
                <input id="inlineEndpoint" type="url" placeholder="https://example.com/api/deploy" style="margin-left:auto;min-width:220px" />
              </div>

              <div style="display:flex;gap:8px;margin-top:14px">
                <button id="inlineDeployBtn" class="btn primary">Deploy Now âžœ</button>
                <button id="inlineCancelBtn" class="btn ghost">Reset</button>
                <button id="inlineSimulateFail" class="btn warn" title="Force fail for demo">Force Fail</button>
              </div>
            </div>
          </div>

          <!-- Live preview / logs -->
          <div class="card" id="livePanel">
            <div style="display:flex;align-items:center;gap:10px">
              <div style="font-weight:800">Live Deployment</div>
              <div class="muted" style="margin-left:auto">Status: <span id="liveStatus" style="font-weight:800">idle</span></div>
            </div>

            <div style="margin-top:12px">
              <div class="progress" aria-hidden="true"><i id="progressBar"></i></div>
              <div style="display:flex;gap:8px;margin-top:8px;align-items:center">
                <div class="muted">Progress:</div>
                <div id="progressPct" style="font-weight:800">0%</div>
                <div class="right">
                  <button id="cancelDeploy" class="btn ghost">Cancel</button>
                </div>
              </div>
            </div>

            <div style="margin-top:12px">
              <div style="display:flex;gap:8px;align-items:center">
                <div style="font-weight:700">Logs</div>
                <div class="muted" style="margin-left:auto">Live console-like output</div>
              </div>
              <pre id="logs" class="logs" aria-live="polite" tabindex="0">No logs yet.</pre>
            </div>

            <div style="display:flex;gap:8px;margin-top:12px;flex-wrap:wrap">
              <button id="copyLogs" class="btn ghost">Copy Logs</button>
              <button id="clearLogs" class="btn ghost">Clear Logs</button>
              <button id="openConsole" class="btn ghost">Open Console (new window)</button>
            </div>
          </div>
        </div>
      </section>

      <!-- DASHBOARD -->
      <section id="dashboard" class="page">
        <div class="card">
          <div style="display:flex;align-items:center;gap:12px">
            <div style="font-weight:800">Dashboard</div>
            <div class="muted" style="margin-left:auto">Manage your projects</div>
          </div>

          <div style="margin-top:12px;display:flex;gap:12px;flex-wrap:wrap">
            <div class="card" style="min-width:240px">
              <div style="font-weight:700">Total Deployments</div>
              <div id="statDeploys" style="font-size:22px;margin-top:6px">0</div>
            </div>
            <div class="card" style="min-width:240px">
              <div style="font-weight:700">Active Projects</div>
              <div id="statProjects" style="font-size:22px;margin-top:6px">0</div>
            </div>
            <div class="card" style="min-width:240px">
              <div style="font-weight:700">Avg Build Time</div>
              <div id="statAvg" style="font-size:22px;margin-top:6px">â€”</div>
            </div>
          </div>

          <div style="margin-top:16px">
            <div style="display:flex;gap:8px;align-items:center">
              <div style="font-weight:700">Active Deployments</div>
              <div class="muted" style="margin-left:auto">You can redeploy or visit</div>
            </div>

            <div id="activeList" style="margin-top:12px"></div>
          </div>
        </div>
      </section>

      <!-- RESULTS -->
      <section id="results" class="page">
        <div class="card">
          <div style="display:flex;align-items:center;gap:12px">
            <div style="font-weight:800">Results</div>
            <div class="muted" style="margin-left:auto">Recent runs</div>
          </div>

          <table class="results-table" id="resultsTable" aria-describedby="results">
            <thead>
              <tr><th>Project</th><th>Status</th><th>Framework</th><th>Time</th><th>Build</th><th>Visitors</th></tr>
            </thead>
            <tbody id="resultsTbody">
              <!-- dynamic rows -->
            </tbody>
          </table>
        </div>
      </section>

      <!-- FEEDBACK -->
      <section id="feedback" class="page">
        <div class="card">
          <div style="display:flex;align-items:center;gap:12px">
            <div style="font-weight:800">Feedback</div>
            <div class="muted" style="margin-left:auto">Help us improve DeXpress</div>
          </div>

          <div style="margin-top:12px">
            <label class="muted">How was your experience?</label>
            <textarea id="feedbackText" placeholder="Write feedback..."></textarea>
            <div style="display:flex;gap:8px;margin-top:8px">
              <input id="contactMe" type="checkbox" />
              <label class="muted">Contact me about this</label>
              <div class="right"><button id="sendFeedback" class="btn primary">Send Feedback</button></div>
            </div>
          </div>
        </div>
      </section>

    </div>
  </main>

  <button id="floatingHelp" class="btn primary" style="position:fixed;right:18px;bottom:18px;border-radius:50%;width:56px;height:56px;font-size:20px">?</button>
</div>

<!-- Modal template (hidden until needed) -->
<div id="modalRoot" style="display:none"></div>

<!-- React demo loader -->
<div id="reactDemoRoot" style="display:none"></div>

<script>
/* ---------- Utilities & state ---------- */

const qs = s => document.querySelector(s);
const qsa = s => Array.from(document.querySelectorAll(s));

/* Projects / runs state persisted in localStorage */
const STORAGE_KEY = 'dexpress_state_v1';
let state = {
  projects: [], // {id, name, repo, framework, region, domain, visitors, lastRun}
  runs: [],     // {id, projectId, status, startedAt, finishedAt, buildTime, logs}
  running: {}   // running deployment metadata by runId
};
// load
try {
  const raw = localStorage.getItem(STORAGE_KEY);
  if(raw) state = JSON.parse(raw);
} catch(e){ console.warn('state load fail', e) }

function saveState(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }

/* helpers */
function id(prefix='id'){ return prefix + '_' + Math.random().toString(36).slice(2,9); }
function nowISO(){ return new Date().toISOString(); }
function msToHuman(ms){
  if(!ms) return 'â€”';
  const s = Math.round(ms/1000);
  if(s < 60) return s + 's';
  const m = Math.floor(s/60);
  return `${m}m ${s%60}s`;
}

/* ---------- UI wiring / navigation ---------- */

qsa('.navlink').forEach(a=>{
  a.addEventListener('click', e=>{
    e.preventDefault();
    const target = a.dataset.target || a.getAttribute('href').replace('#','');
    goToSection(target);
  });
});
qsa('.access-btn').forEach(b=>{
  b.addEventListener('click', ()=> goToSection(b.dataset.target));
});
function goToSection(id){
  const el = document.getElementById(id);
  if(!el) return;
  el.scrollIntoView({behavior:'smooth',block:'start'});
  qsa('.navlink').forEach(n=>n.classList.remove('active'));
  const nav = document.querySelector(`.navlink[data-target="${id}"]`);
  if(nav) nav.classList.add('active');
  qsa('.access-btn').forEach(n=>n.classList.remove('active'));
  const acc = document.querySelector(`.access-btn[data-target="${id}"]`);
  if(acc) acc.classList.add('active');
}

/* theme toggle */
const themeToggle = qs('#toggleTheme');
themeToggle.addEventListener('click', ()=>{
  document.documentElement.classList.toggle('theme-red');
  const isRed = document.documentElement.classList.contains('theme-red');
  themeToggle.textContent = isRed ? 'RED' : 'THEME';
});

/* open deploy modal from header and hero */
qs('#openDeploy').addEventListener('click', openDeployModal);
qs('#heroDeploy').addEventListener('click', openDeployModal);

/* inline deploy button */
qs('#inlineDeployBtn').addEventListener('click', () => {
  const payload = gatherInlineForm();
  if(!payload) return;
  startDeployment(payload);
});
qs('#inlineCancelBtn').addEventListener('click', () => {
  qs('#inlineProjectName').value = '';
  qs('#inlineRepo').value = '';
  qs('#inlineFramework').value = 'Auto-detect';
  qs('#inlineEndpoint').value = '';
  qs('#inlineSendApi').checked = false;
});
qs('#inlineSimulateFail').addEventListener('click', ()=> {
  const payload = gatherInlineForm();
  if(!payload) return;
  payload.forceFail = true;
  startDeployment(payload);
});

/* export / import */
qs('#exportJson').addEventListener('click', ()=> {
  const blob = new Blob([JSON.stringify(state, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'dexpress-projects.json'; a.click();
  URL.revokeObjectURL(url);
});
qs('#importBtn').addEventListener('click', ()=> qs('#importFile').click());
qs('#importFile').addEventListener('change', async (e) => {
  const f = e.target.files[0];
  if(!f) return;
  try {
    const text = await f.text();
    const parsed = JSON.parse(text);
    if(parsed.projects && parsed.runs){
      state = parsed; saveState(); refreshAll();
      alert('Imported successfully');
    } else {
      alert('Invalid file format');
    }
  } catch(err){ alert('Import failed: '+err.message); }
});

/* feedback */
qs('#sendFeedback').addEventListener('click', ()=>{
  const text = qs('#feedbackText').value.trim();
  if(!text){ alert('Please write feedback'); return; }
  // store feedback locally (simple)
  const fb = {id:id('fb'), text, contact: qs('#contactMe').checked, date: nowISO()};
  const storageKey = 'dexpress_feedback';
  let arr = [];
  try { arr = JSON.parse(localStorage.getItem(storageKey) || '[]'); } catch{}
  arr.unshift(fb); localStorage.setItem(storageKey, JSON.stringify(arr));
  qs('#feedbackText').value = '';
  alert('Thanks â€” feedback submitted!');
});

/* open React demo (loads React + mounts a tiny app) */
qs('#openReactDemo').addEventListener('click', openReactDemo);

/* copy/clear/open logs */
qs('#copyLogs').addEventListener('click', () => navigator.clipboard?.writeText(qs('#logs').textContent || '').then(()=>alert('Logs copied')));
qs('#clearLogs').addEventListener('click', ()=> qs('#logs').textContent = '');
qs('#openConsole').addEventListener('click', () => {
  const w = window.open('', '_blank', 'width=800,height=600');
  w.document.write('<pre style="white-space:pre-wrap;font-family:monospace;padding:12px">' + escapeHtml(qs('#logs').textContent || '') + '</pre>');
});

/* keyboard shortcut to focus toolbar */
document.addEventListener('keydown', (e)=>{
  if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='k'){ e.preventDefault(); qs('header.toolbar').focus(); }
});

/* ---------- Modal: deploy form (full featured) ---------- */

function openDeployModal(){
  const root = qs('#modalRoot');
  root.style.display = 'block';
  root.innerHTML = `
    <div class="modal-backdrop" role="dialog" aria-modal="true">
      <div class="modal" id="deployModal">
        <div style="display:flex;align-items:center;gap:12px">
          <div style="font-size:18px;font-weight:800">New Deployment</div>
          <div class="muted" style="margin-left:auto">Create and run</div>
        </div>

        <div style="margin-top:12px">
          <div class="field">
            <label class="muted">Project name</label>
            <input id="mProjectName" type="text" placeholder="my-awesome-app" value="my-awesome-app" />
          </div>

          <div class="field">
            <label class="muted">Repository URL</label>
            <input id="mRepo" type="url" placeholder="https://github.com/org/repo" />
          </div>

          <div class="form-row">
            <div class="col field">
              <label class="muted">Framework</label>
              <select id="mFramework">
                <option>Auto-detect</option><option>React</option><option>Next.js</option><option>Vue</option><option>Node</option>
              </select>
            </div>
            <div class="col field">
              <label class="muted">Region</label>
              <select id="mRegion"><option>us-east-1</option><option>eu-west-1</option><option>ap-south-1</option></select>
            </div>
          </div>

          <div style="display:flex;gap:8px;align-items:center">
            <input id="mSendApi" type="checkbox" />
            <label class="muted">Send POST to endpoint</label>
            <input id="mEndpoint" type="url" placeholder="https://example.com/api/deploy" style="margin-left:auto;min-width:200px" />
          </div>

          <div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end">
            <button id="modalCancel" class="btn ghost">Cancel</button>
            <button id="modalDeploy" class="btn primary">Deploy Now</button>
          </div>
        </div>
      </div>
    </div>
  `;

  // wire modal events
  qs('#modalCancel').addEventListener('click', closeModal);
  qs('#deployModal').addEventListener('keydown', e=>{ if(e.key==='Escape') closeModal(); });
  qs('#modalDeploy').addEventListener('click', ()=>{
    const payload = {
      name: qs('#mProjectName').value.trim(),
      repo: qs('#mRepo').value.trim(),
      framework: qs('#mFramework').value,
      region: qs('#mRegion').value,
      sendApi: qs('#mSendApi').checked,
      endpoint: qs('#mEndpoint').value.trim()
    };
    if(!payload.name){ alert('Project name is required'); return; }
    closeModal();
    startDeployment(payload);
  });
  // focus first input
  setTimeout(()=>qs('#mProjectName')?.focus(), 120);
}
function closeModal(){ const root = qs('#modalRoot'); root.innerHTML=''; root.style.display='none'; }

/* gather inline form */
function gatherInlineForm(){
  const name = qs('#inlineProjectName').value.trim();
  if(!name){ alert('Please enter project name'); qs('#inlineProjectName').focus(); return null; }
  return {
    name,
    repo: qs('#inlineRepo').value.trim(),
    framework: qs('#inlineFramework').value,
    region: qs('#inlineRegion').value,
    sendApi: qs('#inlineSendApi').checked,
    endpoint: qs('#inlineEndpoint').value.trim()
  };
}

/* ---------- Deployment simulation & API ---------- */

/*
  Behavior:
   - When startDeployment(payload) is called, a new project (if not exists) and a run record are created.
   - UI enters "running" state: progress bar updates, logs appended.
   - If payload.sendApi and endpoint provided, we POST JSON to endpoint, show response and adjust status depending on HTTP code.
   - Supports forceFail in payload to demonstrate failure path.
   - Can cancel via cancel button (uses run id)
*/

function startDeployment(payload){
  // create or reuse project
  let project = state.projects.find(p => p.name === payload.name);
  if(!project){
    project = {
      id: id('proj'),
      name: payload.name,
      repo: payload.repo || '',
      framework: payload.framework || 'Auto-detect',
      region: payload.region || '',
      domain: `${payload.name.replace(/\s+/g,'-')}.dexpress.app`,
      visitors: Math.floor(Math.random()*5000),
      lastRun: null
    };
    state.projects.unshift(project);
  } else {
    // update some fields
    project.repo = payload.repo || project.repo;
    project.framework = payload.framework || project.framework;
    project.region = payload.region || project.region;
  }
  saveState(); refreshAll();

  // create run
  const runId = id('run');
  const run = { id: runId, projectId: project.id, status: 'running', startedAt: nowISO(), finishedAt: null, buildTime: null, logs: [] };
  state.runs.unshift(run);
  state.running[runId] = { cancel:false };
  saveState(); refreshAll();

  // UI: live panel & logs
  setLiveStatus('starting');
  appendLog(`Run ${runId} starting for ${project.name}...`);
  qs('#progressBar').style.width = '2%';
  qs('#progressPct').textContent = '0%';
  qs('#liveStatus').textContent = 'starting';
  qs('#liveStatus').style.color = 'inherit';

  // progress flow
  const totalSteps = 5 + Math.floor(Math.random()*4); // randomized steps
  let step = 0;
  const startTs = Date.now();

  function nextStep(){
    if(state.running[runId].cancel){
      appendLog('Deployment canceled by user.');
      finalizeRun('canceled', runId, Date.now()-startTs);
      return;
    }
    step++;
    const pct = Math.min(100, Math.round((step / totalSteps) * 100));
    qs('#progressBar').style.width = pct + '%';
    qs('#progressPct').textContent = pct + '%';
    appendLog(`Step ${step}/${totalSteps}: ${stepMessage(step)}...`);

    // random simulated output
    if(Math.random() < 0.25){
      appendLog(`[info] npm install completed in ${Math.round(Math.random()*6)+1}s`);
    }
    // simulate step delay
    const stepDelay = 700 + Math.random()*1200;
    setTimeout(()=> {
      // early fail if forced
      if(payload.forceFail && step >= Math.ceil(totalSteps/2)){
        appendLog('[error] Unexpected exit code 1');
        finalizeRun('failed', runId, Date.now()-startTs);
        return;
      }
      if(step < totalSteps){
        nextStep();
      } else {
        // finished local build; if sendApi is enabled, POST payload
        if(payload.sendApi && payload.endpoint){
          appendLog(`Posting payload to ${payload.endpoint} ...`);
          // try fetch
          fetch(payload.endpoint, {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body: JSON.stringify({ project: project, runId })
          }).then(async res => {
            const text = await res.text().catch(()=>'<no-body>');
            appendLog(`[api] HTTP ${res.status} ${res.statusText} â€” response: ${text.slice(0,500)}`);
            if(res.ok){
              finalizeRun('success', runId, Date.now()-startTs);
            } else {
              finalizeRun('failed', runId, Date.now()-startTs);
            }
          }).catch(err => {
            appendLog('[api] Request failed: ' + err.message);
            appendLog('[fallback] Continuing with local deploy simulation');
            // fallback: finalize as success
            finalizeRun('success', runId, Date.now()-startTs);
          });
        } else {
          // purely local simulation
          finalizeRun('success', runId, Date.now()-startTs);
        }
      }
    }, stepDelay);
  }

  nextStep();

  // attach cancel handler
  const cancelBtn = qs('#cancelDeploy');
  const prevHandler = cancelBtn._handler;
  if(prevHandler) cancelBtn.removeEventListener('click', prevHandler);
  const handler = ()=> {
    state.running[runId].cancel = true;
  };
  cancelBtn.addEventListener('click', handler);
  cancelBtn._handler = handler;

  return runId;
}

function stepMessage(step){
  const msgs = ['Cloning repo','Installing dependencies','Building assets','Running tests','Packaging artifacts','Uploading','Configuring platform','Activating services'];
  return msgs[(step-1) % msgs.length] || 'Working';
}

function finalizeRun(status, runId, msTaken=0){
  const run = state.runs.find(r => r.id === runId);
  if(!run) return;
  run.status = status;
  run.finishedAt = nowISO();
  run.buildTime = msToHuman(msTaken);
  // update project lastRun
  const proj = state.projects.find(p => p.id === run.projectId);
  if(proj){
    proj.lastRun = run.finishedAt;
    if(status==='success') proj.visitors = Math.max(0, proj.visitors + Math.floor(Math.random()*200));
  }
  // update UI
  if(status === 'success') setLiveStatus('success');
  else if(status === 'failed') setLiveStatus('failed');
  else if(status === 'canceled') setLiveStatus('canceled');

  // cleanup running
  delete state.running[runId];
  saveState();
  refreshAll();
  appendLog(`Run ${runId} finished â€” status: ${status} â€” build: ${run.buildTime}`);
}

/* live UI helpers */
function setLiveStatus(t){
  qs('#liveStatus').textContent = t;
  if(t === 'success') qs('#liveStatus').style.color = 'green';
  else if(t === 'failed') qs('#liveStatus').style.color = 'red';
  else qs('#liveStatus').style.color = 'inherit';
}
function appendLog(text){
  const el = qs('#logs');
  const ts = (new Date()).toLocaleTimeString();
  if(el.textContent === 'No logs yet.') el.textContent = '';
  el.textContent += `[${ts}] ${text}\n`;
  el.scrollTop = el.scrollHeight;
}

/* cancel all running (cleanup) */
window.addEventListener('beforeunload', ()=>{ Object.keys(state.running).forEach(k=>state.running[k].cancel=true); });

/* ---------- UI refresh based on state ---------- */

function refreshAll(){
  // stats
  qs('#statDeploys').textContent = state.runs.length;
  qs('#statProjects').textContent = state.projects.length;
  const succRuns = state.runs.filter(r=>r.status==='success');
  const avgMs = 0; // leave as dash unless we compute
  qs('#statAvg').textContent = succRuns.length ? succRuns.slice(0,20).map(r=> parseBuildTime(r.buildTime) ).filter(Boolean).reduce((a,b)=>a+b,0)/Math.max(1,succRuns.length) : 'â€”';

  // active list
  const activeList = qs('#activeList'); activeList.innerHTML = '';
  state.projects.slice(0,10).forEach(p=>{
    const el = document.createElement('div'); el.className='card'; el.style.marginBottom='8px';
    el.innerHTML = `<div style="display:flex;gap:12px;align-items:center">
      <div style="font-weight:800">${escapeHtml(p.name)}</div>
      <div class="muted">${escapeHtml(p.domain)}</div>
      <div style="margin-left:auto;display:flex;gap:8px">
        <button class="btn ghost" data-act="visit" data-id="${p.id}">Visit</button>
        <button class="btn primary" data-act="redeploy" data-id="${p.id}">Redeploy</button>
      </div>
    </div>
    <div class="muted" style="margin-top:8px">Framework: ${escapeHtml(p.framework)} â€¢ Region: ${escapeHtml(p.region || 'auto')}</div>`;
    activeList.appendChild(el);
  });
  // attach actions
  qsa('#activeList [data-act]').forEach(btn=>{
    btn.addEventListener('click',(e)=>{
      const id = btn.dataset.id;
      const act = btn.dataset.act;
      if(act==='visit'){ alert('Open site: ' + (state.projects.find(p=>p.id===id)?.domain || 'â€”')) }
      if(act==='redeploy'){
        const proj = state.projects.find(p=>p.id===id);
        if(proj) startDeployment({ name: proj.name, repo: proj.repo, framework: proj.framework, region: proj.region });
      }
    });
  });

  // results table (recent runs)
  const tbody = qs('#resultsTbody'); tbody.innerHTML = '';
  state.runs.slice(0,30).forEach(r=>{
    const p = state.projects.find(pp=>pp.id===r.projectId) || {name:'â€”', domain:'â€”', framework:'â€”'};
    const row = document.createElement('tr');
    row.innerHTML = `<td><strong>${escapeHtml(p.name)}</strong><div class="muted">${escapeHtml(p.domain)}</div></td>
      <td>${r.status === 'success' ? `<span class="status success">success</span>` : r.status === 'running' ? `<span class="status">running</span>` : `<span class="status failed">${escapeHtml(r.status)}</span>`}</td>
      <td>${escapeHtml(p.framework || 'â€”')}</td>
      <td>${r.finishedAt ? new Date(r.finishedAt).toLocaleString() : (r.startedAt?new Date(r.startedAt).toLocaleString():'â€”')}</td>
      <td>${escapeHtml(r.buildTime || 'â€”')}</td>
      <td>${p.visitors ?? '-'}</td>`;
    tbody.appendChild(row);
  });

  saveState();
}

/* helper to parse strings like '12s' or '1m 12s' back to seconds for averaging (approx) */
function parseBuildTime(txt){
  if(!txt || txt==='â€”') return 0;
  const m = txt.match(/(\d+)m/); const s = txt.match(/(\d+)s/);
  let total = 0;
  if(m) total += Number(m[1])*60;
  if(s) total += Number(s[1]);
  return total;
}

/* small escape helper */
function escapeHtml(s){ return String(s || '').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

/* parse '12s' to numeric seconds */
function parseBuildTimeToSecs(str){
  if(!str) return 0;
  if(str.endsWith('s')) return Number(str.replace('s','')) || 0;
  return 0;
}

/* ---------- Modal: React demo (on-demand) ---------- */

async function openReactDemo(){
  // show a small modal that loads React + runs a tiny app
  const root = qs('#reactDemoRoot');
  root.style.display = 'block';
  root.innerHTML = `
    <div class="modal-backdrop" role="dialog" aria-modal="true">
      <div class="modal" id="reactModal" style="max-width:820px">
        <div style="display:flex;align-items:center;gap:12px">
          <div style="font-size:18px;font-weight:800">React Demo</div>
          <div class="muted" style="margin-left:auto">Small interactive demo using React (loaded from CDN)</div>
        </div>
        <div id="reactMount" style="margin-top:12px"></div>
        <div style="display:flex;justify-content:flex-end;margin-top:12px">
          <button id="closeReactModal" class="btn ghost">Close</button>
        </div>
      </div>
    </div>
  `;

  qs('#closeReactModal').addEventListener('click', ()=> { root.innerHTML=''; root.style.display='none'; });

  // load React + ReactDOM (UMD) from unpkg if not present
  if(!window.React){
    try{
      await loadScript('https://unpkg.com/react@18/umd/react.development.js');
      await loadScript('https://unpkg.com/react-dom@18/umd/react-dom.development.js');
    }catch(err){
      console.error('React load failed', err);
      qs('#reactMount').textContent = 'Failed to load React from CDN.';
      return;
    }
  }

  // mount a tiny component
  const e = window.React.createElement;
  function Demo(){
    const [count, setCount] = React.useState(0);
    const [text, setText] = React.useState('');
    return e('div', null,
      e('div', {style:{display:'flex',gap:8,alignItems:'center'}},
        e('button', {className:'btn primary', onClick: ()=> setCount(c=>c+1)}, 'Click me'),
        e('div', null, 'Count: ', e('strong', null, count)),
        e('input', {value:text, onChange: (ev)=>setText(ev.target.value), placeholder:'type to bind', style:{marginLeft:12,padding:8,borderRadius:8}})
      ),
      e('div', {style:{marginTop:12}}, e('div', {style:{fontWeight:700}}, 'Data preview:'), e('pre', {style:{background:'#0b1220',color:'#dbeafe',padding:12,borderRadius:8}}, JSON.stringify({count,text},null,2)))
    );
  }
  const mount = document.getElementById('reactMount');
  ReactDOM.createRoot(mount).render(e(Demo));
}

/* helper to dynamically load script */
function loadScript(src){
  return new Promise((resolve, reject) => {
    const s = document.createElement('script');
    s.src = src; s.onload = resolve; s.onerror = reject;
    document.head.appendChild(s);
  });
}

/* ---------- small helpers ---------- */
function escapeHTML(s){ return s.replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])); }

/* ---------- init ---------- */

// initial wiring: hero button that opens deploy modal wired above
// initial refresh
refreshAll();

// load some demo entries if empty
if(state.projects.length === 0 && state.runs.length === 0){
  state.projects = [
    {id:id('proj'), name:'ecommerce-store', repo:'https://github.com/demo/ecomm', framework:'React', region:'us-east-1', domain:'ecommerce-store.dexpress.app', visitors:2400, lastRun: nowISO()},
    {id:id('proj'), name:'portfolio-website', repo:'https://github.com/demo/portfolio', framework:'Next.js', region:'eu-west-1', domain:'portfolio-website.dexpress.app', visitors:892, lastRun: nowISO()}
  ];
  state.runs = [
    {id:id('run'), projectId: state.projects[0].id, status:'success', startedAt: nowISO(), finishedAt: nowISO(), buildTime:'28s', logs:[]},
    {id:id('run'), projectId: state.projects[1].id, status:'success', startedAt: nowISO(), finishedAt: nowISO(), buildTime:'15s', logs:[]}
  ];
  saveState();
  refreshAll();
}

/* small helper to parse buildTime string like '1m 12s' to seconds */
function parseBuildTime(str){
  if(!str) return 0;
  const m = (str.match(/(\d+)m/) || [0,0])[1];
  const s = (str.match(/(\d+)s/) || [0,0])[1];
  return Number(m)*60 + Number(s || 0);
}
</script>
<style>
/* Gradient backdrop */
.modal-backdrop {
  position: fixed;
  inset: 0;
  background: linear-gradient(135deg, #a78bfa, #3b82f6, #c4b5fd);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 3000;
  animation: fadeIn 0.2s forwards;
  opacity: 0;
}

@keyframes fadeIn {
  to { opacity: 1; }
}

@keyframes fadeOut {
  to { opacity: 0; }
}

/* Light-themed modal */
.modal {
  background: #ffffff;
  color: #111827;
  padding: 24px 28px;
  border-radius: 16px;
  max-width: 400px;
  width: 90%;
  box-shadow: 0 8px 24px rgba(0,0,0,0.2);
  font-family: 'Segoe UI', sans-serif;
}

/* Header */
.modal-header {
  display: flex;
  align-items: center;
  gap: 12px;
}

.modal-header .title {
  font-size: 20px;
  font-weight: 700;
  color: #4f46e5; /* Light purple accent */
}

.modal-header .close-btn {
  margin-left: auto;
  cursor: pointer;
  border: none;
  background: none;
  font-size: 18px;
  color: #374151;
  transition: color 0.2s;
}

.modal-header .close-btn:hover {
  color: #ef4444;
}

/* Modal content */
.modal p {
  margin-top: 14px;
  line-height: 1.5;
  font-size: 15px;
}

.modal p strong {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  color: #3b82f6; /* Blue accent */
}
</style>

<script>
const helpBtn = document.getElementById('floatingHelp');

function createModal(content) {
  const backdrop = document.createElement('div');
  backdrop.className = 'modal-backdrop';
  backdrop.innerHTML = content;

  // Close modal on clicking close button or backdrop
  backdrop.addEventListener('click', (e) => {
    if (e.target.classList.contains('close-btn') || e.target === backdrop) {
      backdrop.style.animation = 'fadeOut 0.2s forwards';
      setTimeout(() => backdrop.remove(), 200);
    }
  });

  document.body.appendChild(backdrop);
}

helpBtn.addEventListener('click', () => {
  const modalContent = `
    <div class="modal">
      <div class="modal-header">
        <div class="title">Need Help?</div>
        <button class="close-btn">âœ–</button>
      </div>
      <p>
        Contact us at <strong>ðŸ“§ DeXpress@gmail.com</strong> or DM us at <strong>ðŸ“¸ @DeXpresters</strong>
      </p>
    </div>
  `;
  createModal(modalContent);
});
</script>
<script>
(() => {
  const trailCount = 8; // Number of trail dots
  const trail = [];
  const colors = ['#a78bfa', '#3b82f6', '#c4b5fd']; // gradient-like colors

  // Create trail elements
  for (let i = 0; i < trailCount; i++) {
    const dot = document.createElement('div');
    dot.style.position = 'fixed';
    dot.style.pointerEvents = 'none';
    dot.style.width = '10px';
    dot.style.height = '10px';
    dot.style.borderRadius = '50%';
    dot.style.background = colors[i % colors.length];
    dot.style.opacity = (0.6 - i * 0.06).toString();
    dot.style.transform = 'translate(-50%, -50%)';
    dot.style.zIndex = '9999';
    document.body.appendChild(dot);
    trail.push({el: dot, x: 0, y: 0});
  }

  let mouseX = 0;
  let mouseY = 0;

  window.addEventListener('mousemove', (e) => {
    mouseX = e.clientX;
    mouseY = e.clientY;
  });

  function animateTrail() {
    let x = mouseX;
    let y = mouseY;

    for (let i = 0; i < trail.length; i++) {
      const dot = trail[i];
      dot.x += (x - dot.x) * 0.25;
      dot.y += (y - dot.y) * 0.25;
      dot.el.style.left = dot.x + 'px';
      dot.el.style.top = dot.y + 'px';
      x = dot.x;
      y = dot.y;
    }
    requestAnimationFrame(animateTrail);
  }

  animateTrail();
})();
</script>


</body>
</html>